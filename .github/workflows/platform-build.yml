name: Build StreamNative Platform
on:
  push:
    branches:
      - release/platform

jobs:
  build:
    name: build sn platform
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v1

      - name: get dependence files
        run: |
          cd platform/secrets
          ./test.sh && ./get-master-code.sh

      - name: build tarball
        run: |
          cd platform/
          version=`cat VERSION`
          tar -czvf sn-platform-$version.tar.gz sn-platform

#      - name: build zip
#        run: |
#          cd platform/
#          zip â€“r sn-platform.zip sn-platform/*

      - name: publish code to github
        run: |
          cd platform/
        uses: skx/github-action-publish-binaries@release-0.11
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          args: 'sn-platform*'
